<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Playing along with Rules as Code Part 3 | Jason Morris</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="This is the third in a series of posts were I follow along with the Government of Canada’s Rules as Code discovery project. In this post…">
<meta name=generator content="Hugo 0.92.2">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/ananke/css/main.min.css>
<meta property="og:title" content="Playing along with Rules as Code Part 3">
<meta property="og:description" content="This is the third in a series of posts were I follow along with the Government of Canada’s Rules as Code discovery project. In this post…">
<meta property="og:type" content="article">
<meta property="og:url" content="https://JasonMorrisSC.github.io/post/roundtablelaw/playing-along-with-rules-as-code-part-3-52d6286f8245/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-02-27T01:33:42+00:00">
<meta property="article:modified_time" content="2020-02-27T01:33:42+00:00">
<meta itemprop=name content="Playing along with Rules as Code Part 3">
<meta itemprop=description content="This is the third in a series of posts were I follow along with the Government of Canada’s Rules as Code discovery project. In this post…"><meta itemprop=datePublished content="2020-02-27T01:33:42+00:00">
<meta itemprop=dateModified content="2020-02-27T01:33:42+00:00">
<meta itemprop=wordCount content="1655">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Playing along with Rules as Code Part 3">
<meta name=twitter:description content="This is the third in a series of posts were I follow along with the Government of Canada’s Rules as Code discovery project. In this post…">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/ class="f3 fw2 hover-white no-underline white-90 dib">
Jason Morris
</a>
<div class="flex-l items-center">
<ul class="pl0 mr3">
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/about/ title="About Jason page">
About Jason
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/project/ title="Projects page">
Projects
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/post/ title="Rules as Code Diary page">
Rules as Code Diary
</a>
</li>
</ul>
<div class=ananke-socials>
<a href=https://twitter.com/RoundTableLaw target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">
<span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:{{ .fill }}"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div>
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
RULES AS CODE DIARY
</aside>
<div id=sharing class="mt3 ananke-socials">
<a href="https://twitter.com/share?url=https://JasonMorrisSC.github.io/post/roundtablelaw/playing-along-with-rules-as-code-part-3-52d6286f8245/&text=Playing%20along%20with%20Rules%20as%20Code%20Part%203" class="ananke-social-link twitter no-underline" aria-label="share on Twitter">
<span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:{{ .fill }}"/></svg>
</span>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Playing along with Rules as Code Part 3</h1>
<time class="f6 mv4 dib tracked" datetime=2020-02-27T01:33:42Z>February 27, 2020</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>This is the third in a series of posts were I follow along with the Government of Canada’s Rules as Code discovery project. In this post, I’m going to start modelling the legislation in Oracle Intelligent Advisor.</p>
<p>Check out <a href="https://medium.com/@jason_90344/playing-along-with-rules-as-code-6c837b42a33e?source=friends_link&sk=013140917e157dc209fd1f14ad709ee7">the first post</a> for an explanation of the source material, and <a href="https://medium.com/@jason_90344/playing-along-with-rules-as-code-part-2-4acc82c53f95?source=friends_link&sk=e69c1c1b37f1f9e20b02095291a7a63c">the second post</a> for an explanation of why we’re starting again in OIA after having begun in Flora-2.</p>
<h3 id=ontology-take-2>Ontology Take 2</h3>
<p>The ontology we are going to build here is going to be smaller than the one we started with, because we are only aiming at being able to answer questions about vacation pay. Specifically, we are aiming only to be able to answer questions about how much vacation pay a person is entitled to. Because I like things more complicated than they need to be, I’m going to also try to answer question about when that pay is due.</p>
<p>The tool that you use to generate the ontology when using Oracle Intelligent Advisor is the “Data” section of Oracle Policy Modelling, which looks like this:</p>
<p><img src=/1__T6I5AmpgjUdgpVDdElljiQ.png alt></p>
<p>You can see that the screen is divided into three parts. The left part is a tree-structured list of “entity types”. Each entity type has a list of “attributes” in the top right, which are base data-type information about that entity type, and “relationships” on the bottom right, which are relationships between this data type and other data types.</p>
<p>Unlike in Flora-2, OPM allows you to specify at the ontology phase that relationships are one-to-one, one-to-many, or many-to-many.</p>
<p>The tree structure for entity types expresses a “has” relationship, which is always one-to-many. The entity type closer to the root “has” one or more objects of the entity type below. Entity types that are not contained by anything else are contained by the Global object.</p>
<p>So a text description of what the entity type tree above says might be:</p>
<p>The Global Object has one or more Employees, one or more Employers, and one or more Employments.<br>
An Employer has one or more Industrial Establishments.<br>
An Industrial Establishment has one or more Determined Year of Employment, and one or more Regular Pay Days.<br>
An Employment has one or more Vacation Period, and one or more Year of Employment.</p>
<p>When you click on one entity type in the tree, the interface shows you the attributes and relationships for that entity type. The relationships list will always include the “is part of” relationship to its parent entity type, and the “has a” relationships to sub-types. So “Industrial Establishment” has a relationship to its parent “Employer” by default.</p>
<p>You can see in the image above that “employment” has a relationship to employer, employee, industrial establishment, and all instances of the sub-entities of vacation period and year of employment. An employment also has two attributes, a start date and an end date.</p>
<p>All entity types have, by default, an attribute with the same name as the entity type, that serves as the “name” of that entity until you decide to replace it with something else.</p>
<p>The attributes of a Vacation Period are shown here, and consist of a start date, end date, pay due date, a boolean (yes/no) variable for whether it is practicable to pay vacation pay within 14 days prior to the start date, and a boolean for whether that is when the vacation pay is due.</p>
<p><img src=/1__s__l7b7YeGOW5rIjEuVkvEQ.png alt></p>
<p>A year of employment is an object with three attributes, a vacation pay rate, wages, and a vacation pay amount owing.</p>
<p><img src=/1__wi7GjGdMKIV6iBpq__W__6Ug.png alt></p>
<p>I won’t go through the rest of the ontology line by line, but that should give you an idea how it’s structured. You’ll notice that a lot of the names used in OIA are verbose. “Year of Employment Wages” could just be called “Wages”. There are a couple of reasons for that. First, OIA attempts to automatically determine what entity type your attribute belongs to. Leaving the name of the entity type in the name of the attribute makes sure that it guesses correctly.</p>
<p>But more importantly, OIA re-uses all of the names of attributes and relationships and entity types directly in rules, interview screens, and explanations, so it’s important to use terms that will not be ambiguous. In all likelihood we will want to come back and change a bunch of the names once we can see better how they are being used. But for now we will be verbose.</p>
<h3 id=getting-started-with-oia-rules>Getting Started with OIA Rules</h3>
<p>The rules that you write for OIA are written in an obscure application you may have heard of called Microsoft Word. Just to give you a little preview, I created a couple of simple rules to implement section 184.01 of the relevant Act, which is reproduced here:</p>
<blockquote>
<p><strong><em>Calculation of vacation pay</em></strong></p>
</blockquote>
<blockquote>
<p><strong><em>184.01</em></strong> <em>An employee is entitled to vacation pay equal to:</em></p>
</blockquote>
<blockquote>
<p><strong><em>(a)</em></strong> <em>4% of their wages during the year of employment in respect of which they are entitled to the vacation;</em></p>
</blockquote>
<blockquote>
<p><strong><em>(b)</em></strong> <em>6% of their wages during the year of employment in respect of which they are entitled to the vacation, if they have completed at least five consecutive years of employment with the same employer; and</em></p>
</blockquote>
<blockquote>
<p><strong><em>(c)</em></strong> <em>8% of their wages during the year of employment in respect of which they are entitled to the vacation, if they have completed at least 10 consecutive years of employment with the same employer.</em></p>
</blockquote>
<p>OIA allows you to write rules using a decision table style, using a textual style, and using math-like assignment statements. We’ll get into textual rules more next time, but here’s a decision table and an assignment statement to implement 184.01. This is just a first draft and probably doesn’t work. We’ll fix it later.</p>
<p><img src=/1__c8__3cQMQIW3e9U8CSNhsrw.png alt></p>
<p>The highlighted sections show sections of code that are “conditions”. The underlines show references to variables about which OPM already knows. Notice how you can traverse the entity tree in a really intuitive way by saying “the year of employment’s employment” to refer to that relationship, and then saying “the year of employment’s employment’s employee” to refer to a second relationship out, and then “the year of employment’s employment’s employee’s consecutive years of employment with same employer” to get to the attribute of an object that is two relationships away from year of employment.</p>
<p>This is OIA’s super-power. When you name the entities well, the rules are very easy to intuitively write and read.</p>
<h3 id=statutory-interpretation-rears-its-ugly-head>Statutory Interpretation Rears It’s Ugly Head</h3>
<p>One of the purposes of the Rules as Code exercise is to show us how we can make rules better by thinking about them in computational terms. And it didn’t take long to find another example.</p>
<p>If we rephrase section 184.01, it reads:</p>
<blockquote>
<p>A person is entitled to:<br>
4% of their salary,<br>
6% of their salary if they have worked there more than 5 years, and<br>
8% of their slaray if they have worked there more than 10 years.</p>
</blockquote>
<p>The combination of sub-clauses and the word “and” is a bit of a nightmare, here. The general rule is that when you are drafting with subclauses you should be able to combine each subclause with the introduction and know what you need to know, without reference to the other subclauses. Also, if there is an “and” between the last two, you treat them as though there is an “and” between all of them. So we could translate this way:</p>
<blockquote>
<p>A person is entitled to 4% of their salary, and<br>
a person is entitled to 6% of their salary if they have worked there more than 5 years, and<br>
a person is entitled to 8% of their salary if they have worked there fore more than 10 years.</p>
</blockquote>
<p>When is a person entitled to 4% of their salary? Always? Or only when the other two categories don’t apply? If the three categories are mutually exclusive, why are they joined with an “and”? It can’t be because each is contingent, because the first one isn’t. Are you always entitled to 4%, and sometimes entitled to either 6% or 8% also? Are you always entitled to 4%, and always entitled to an additional 6% after 5 years, and always entitled to an addition 8% after 10?</p>
<p>The solution to this problem is to read the context. In section 184, aperson is entitled to 2 weeks after 1 year, 3 weeks after 5 years, or 4 weeks of vacation after 10. There is a contingency on the first one, and the other conditions are the same, and the relationship is 1 to 1.5 to 2. So I’m taking it from context that the difference in vacation pay was probably supposed to be the same, and we reformulate the section to read:</p>
<blockquote>
<p>A person is entitled to 8% vacation pay if they have been there at least 10 years, 6% vacation pay if they have been there at least 5 years, <strong>or</strong> 4% vacation pay otherwise.</p>
</blockquote>
<p>Which is what we put in the decision table above. I’ll leave it as an exercise for the reader as to how we might conclude, based on context, that vacation pay was not supposed to be zero for a person with less than a year of employment, in parallel to vacation time.</p>
<h3 id=coming-attractions>Coming Attractions</h3>
<p>There are a couple of relatively sophisticated things we’re going to need to do to encode these rules. We are definitely going to be using temporal attributes, and we are likely also going to be writing rules that create entities and assign values to their attributes.</p>
<p>By the way, what we have done already, just setting out the ontology, is enough for OPM to automatically generate an interview that will ask for all of the entities, and for all of the attributes of all of the entities. It’s not able to do anything with the data except parrot it back to you yet, and our attribute names are making the questions a little hard to read, but the debugging interview shown below can be generated with zero additional work.</p>
<p><img src=/1__tT__dTdEiottEOZeM2DSw2w.png alt></p>
<ul class=pa0>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">What's in this post</p>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href=#ontology-take-2>Ontology Take 2</a></li>
<li><a href=#getting-started-with-oia-rules>Getting Started with OIA Rules</a></li>
<li><a href=#statutory-interpretation-rears-its-ugly-head>Statutory Interpretation Rears It’s Ugly Head</a></li>
<li><a href=#coming-attractions>Coming Attractions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">Related</p>
<ul class="pa0 list">
<li class=mb2>
<a href=/post/roundtablelaw/playing-along-with-rules-as-code-part-2-4acc82c53f95/>Playing Along With Rules as Code Part 2</a>
</li>
<li class=mb2>
<a href=/post/roundtablelaw/playing-along-with-rules-as-code-6c837b42a33e/>Playing Along with Rules as Code</a>
</li>
</ul>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://JasonMorrisSC.github.io>
&copy; Jason Morris 2022
</a>
<div>
<div class=ananke-socials>
<a href=https://twitter.com/RoundTableLaw target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">
<span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:{{ .fill }}"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div></div>
</div>
</footer>
</body>
</html>